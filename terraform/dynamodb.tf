resource "aws_dynamodb_table" "vulnerability_collector_table" {
  name           = "${var.prefix}-vulnerability_collector"
  billing_mode   = "PAY_PER_REQUEST"
  hash_key       = "hash_key"

  attribute {
    name = "hash_key"
    type = "S"
  }

}

resource "null_resource" "json_file_list" {
  provisioner "local-exec" {
    command = "ls ./init_data > file_json_list"
  }
}
output "json_file_list" {
  value =<<EOF
${file("file_json_list")}
EOF
}

resource "aws_dynamodb_table_item" "init-items" {
  count = length(var.json_file_list)
  table_name = aws_dynamodb_table.vulnerability_collector_table.name
  hash_key = "hash_key"
  item = <<EOF
${file("${var.path}${element(var.json_file_name_list, count.index)}.json")}
EOF
}