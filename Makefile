SHELL = /bin/bash


TOPDIR := $(shell git rev-parse --show-toplevel)
BRANCH := $(git rev-parse --abbrev-ref HEAD)
GOCODE := $(TOPDIR)/gocode
BUILD_ARTIFACTS := $(TOPDIR)/build_artifacts
LAMBDAS := $(GOCODE)/lambdas

aa:
	@echo $(LAMBDAS)

default:
	build

test:
	@go test ./...

build:
	@echo Start Building Process
	@mkdir -p ${BUILD_ARTIFACTS}
	@for d in $(shell ls ${LAMBDAS}) ; do \
		cd $(LAMBDAS)/$$d; \
		DNAME="`pwd | rev | cut -d '/' -f 1 | rev`";\
		go build  -o ${BUILD_ARTIFACTS}/"$$DNAME"; \
		cd ..; \
	done

